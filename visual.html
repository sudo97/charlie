<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Charlie - Git History Visualization</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-top: 0;
      }
    </style>
    <script type="module">
      import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

      const data = {
        name: "Root",
        children: [
          {
            name: "folder1",
            children: [
              {
                name: "file3.txt",
                complexity: 3,
                revisions: 7
              },
              {
                name: "file4.txt",
                complexity: 5,
                revisions: 12
              }
            ]
          },
          {
            name: "file2.txt",
            complexity: 8,
            revisions: 4
          }
        ]
      };

      // Set up dimensions
      const width = 800;
      const height = 600;

      // Create SVG
      const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewBox", [0, 0, width, height])
        .style("max-width", "100%")
        .style("height", "auto");

      // Create hierarchy
      const root = d3.hierarchy(data)
        .sum(d => (d.complexity || 0) * (d.revisions || 0))
        .sort((a, b) => b.complexity - a.complexity);

      // Create pack layout
      const pack = d3.pack()
        .size([width, height])
        .padding(3);

      // Apply pack layout
      pack(root);

      // Find min and max revisions for color scale
      const allNodes = root.descendants();
      const revisionValues = allNodes
        .filter(d => d.data.revisions !== undefined)
        .map(d => d.data.revisions);
      const minRevisions = Math.min(...revisionValues);
      const maxRevisions = Math.max(...revisionValues);

      // Create color scale based on revisions (green to red)
      const color = d3.scaleSequential(d3.interpolateRdYlGn)
        .domain([maxRevisions, minRevisions]); // Reversed domain: high revisions = red, low = green

      // Add circles
      const circles = svg.selectAll("circle")
        .data(root.descendants())
        .join("circle")
        .attr("cx", d => d.x)
        .attr("cy", d => d.y)
        .attr("r", d => d.r)
        .attr("fill", d => {
          // Use revisions for color, fallback to light gray for nodes without revisions (like Root, folder1)
          if (d.data.revisions !== undefined) {
            return color(d.data.revisions);
          }
          return "#e8e8e8"; // Light gray for containers
        })
        .attr("stroke", "#fff")
        .attr("stroke-width", 2)
        .style("opacity", 0.8);

      // Add text labels
      const labels = svg.selectAll("text")
        .data(root.descendants())
        .join("text")
        .attr("x", d => d.x)
        .attr("y", d => d.y - d.r + 15)
        .attr("text-anchor", "middle")
        .attr("dominant-baseline", "hanging")
        .style("font-size", d => Math.min(d.r / 3, 14) + "px")
        .style("font-weight", "bold")
        .style("fill", "#333")
        .style("pointer-events", "none")
        .text(d => d.data.name);

      // Add the SVG to the container
      const container = document.getElementById("visualization");
      container.appendChild(svg.node());
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Git History Visualization</h1>
      <div id="visualization">
        <!-- D3 visualization will be inserted here -->
      </div>
    </div>

    <!-- D3 and data will be added here later -->
  </body>
</html>
